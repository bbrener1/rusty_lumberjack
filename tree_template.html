<head>
  <style>
      #treeContainer {
        height:2000px;
        width:2000px;
        position:absolute;
        min-width:90%;
        /* max-width:100%; */
        /* min-height:95%; */
        margin:.5%;
        padding:.5%;
      }
      .node_container {
        z-index:1;
        background: white;
        opacity: 1;
        border: 1px solid gray;
        box-sizing:border-box;
        border-left:5px solid green;
        box-shadow: 2px 2px 5px gray;
        overflow:auto;
        position:absolute;
        max-width:300px;
        transform: translate(-50%,-50%);

      }
      .header {
        font-size:2vh;
        height:5vh;
      }
      .panel {
        margin:1%;
        padding:1%;
        box-sizing:border-box;
        border-left:5px solid green;
        box-shadow: 2px 2px 5px gray;
      }
      .node_container:hover {
        /* transform: translate(-50%,-50%) scale(2); */
        z-index:2;
        max-width:none;
        width:30vw;
        height:auto;
      }

      .node_header{
        float:left;
        position:absolute;
        padding:3%;
        width:10%;
        height:84%;
        writing-mode:vertical-rl;
        margin:auto;
        text-align:center;
        font-size:150%;
        transform:rotate(180deg);
      }

      .connection {
        stroke:black;
        z-index:-1;
      }
      .sister_map {
        float:right;
        margin:auto;
        height:100%;
        max-width:84%;
      }
      .score_map {
        float:right;
        margin:auto;
        height:100%;
        max-width:84%;
      }
      .feature_header {
        text-align:center;
      }
      .feature_table {
        float:right;
        margin:auto;
        width:84%;
        font-size:78%;
      }
      table {
        font-size:inherit;
      }
      .decoration_type {
        position:fixed;
        left:1%;
        bottom:1%;
        z-index:3;
        background-color:white;
        font-size:1.5vh
      }
      .summary_button {
        font-size:inherit;
        width:100%;
        display:block;
        margin:1%;
      }

    </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    $(document).ready(
      function() {
        insertNodes();
        insertConnections();
        decorateNodesSample();
      });

    function insertNodes() {
      console.log(treeCoordinates);
      let [height,width] = treeCoordinates[0];
      x_total = 300 * (1/width)
      y_total = 200 * (1/height)
      document.getElementById('treeContainer').style.width = `${x_total}px`
      document.getElementById('treeContainer').style.height = `${y_total}px`
      width *= 110;
      height *= 95;
      let style_string = `<style>.node_container {width:${width}%;height:${height}%;}</style>`;
      $("head").append(style_string);
      console.log([width,height,]);
      for (let [index,node] of treeCoordinates.slice(1)) {
        let [x,y] = node.map(function (x) {return x*100});
        console.log(`Node : ${[x,y]}`);
        let style_spec =
          `
            top:${x}%;
            left:${y}%;
          `
        let node_html = `<div id="${index}" class="node_container" style="${style_spec}">${index}</div>`;
        $("#treeContainer").append(node_html);
      }
    }

    function decorateNodesSister() {
      $(".node_container").each(function (index,node) {
        let header_element = `<h5 class="node_header">Cluster ${index}</h5>`;
        node.innerHTML = header_element;
        node.innerHTML += `<a href="./${index}/cluster_summary_template_js.html"><img class="sister_map" src="./${index}/sister_map.png"/></a>`;
      });
    }

    function decorateNodesSample() {
      $(".node_container").each(function (index,node) {
        let header_element = `<h5 class="node_header">Cluster ${index}</h5>`;
        node.innerHTML = header_element;
        node.innerHTML += `<a href="./${index}/cluster_summary_template_js.html"><img class="score_map" src="./${index}/score_map.png"/></a>`;
      });
    }

    function decorateNodesFeatures() {
      $(".node_container").each(function (index,node) {
        let html = `<a href="./${index}/cluster_summary_template_js.html">`;
        html += `<h5 class="node_header">Cluster ${index}</h5>`;
        html += `<h3 class="feature_header">Upregulated</h3>`;
        html += `<div class="feature_table">${summaries[`cluster_${index}`].upregulatedHtml}</div>`;
        html += `<h3 class="feature_header">Downregulated</h3>`;
        html += `<div class="feature_table">${summaries[`cluster_${index}`].downregulatedHtml}</div>`;
        html += '</a>';
        node.innerHTML = html;
      });
    }

    function insertConnections() {
      console.log(connections);
      let connection_string = "";
      for (c of connections) {
        let [y,x,cy,cx,t] = c.map(function (x){return 100*x});
        let coordinate_spec =
        `
        x1="${x}%"
        y1="${y}%"
        x2="${cx}%"
        y2="${cy}%"
        `;
        // let line_html = `<line class="connection" ${coordinate_spec}></line>`;
        let style_spec =
        `
        stroke-width:${t/10000}px;
        `;
        let line_html = `<line class="connection" ${coordinate_spec} style="${style_spec}"></line>`;
        connection_string = connection_string + line_html;
        // $("#lineContainer").append(line_html);

      }
      let svg_string = `<svg id="lineContainer" height="100%" width="100%" style="position:absolute;">${connection_string}</svg>`;
      $("#treeContainer").append(svg_string);
    }


  </script>
</head>
<body>
  <script>
    let summaries = {};
  </script>
  <h1 class="header panel"> Random Forest Consensus Tree</h1>
  <div id="treeContainer">
  </div>
  <div class="decoration_type panel">
      <h2> Switch Node Summary </h2>
      <button class="summary_button" onclick="decorateNodesSample()"> Sample Frequency </button>
      <button class="summary_button" onclick="decorateNodesSister()"> Sister Scores </button>
      <button class="summary_button" onclick="decorateNodesFeatures()"> Changed Features </button>
  </div>
</body>
